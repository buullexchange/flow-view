const x=p=>`--fv-default-${p}`,g=p=>`var(--fv-${p}, var(${x(p)}))`,a={backgroundColor:g("background-color"),boxShadow:g("box-shadow"),connectionColor:g("connection-color"),connectionColorHighlighted:g("connection-color--highlighted"),fontFamily:g("font-family"),fontSize:g("font-size"),nodeBackgroundColor:g("node-background-color"),textColor:g("text-color")},C={"background-color":"#fefefe","connection-color":"#ccc","box-shadow":"0px 0px 7px 1px rgba(0, 0, 0, 0.1)","connection-color--highlighted":"#717171","font-family":"sans-serif","font-Size":"17px","node-background-color":"#fefefe","text-color":"#111"},E=Object.entries(C).reduce((p,[t,e])=>({...p,[x(t)]:e}),{});export{a as cssVar};export{C as cssDefault};export{E as cssTheme};class m{static generateId(t){const e=Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5);return t.shadowRoot.getElementById(e)?m.generateId(t):e}constructor({cssClassName:t,id:e,view:s,...i}){const n=e||m.generateId(s);this.view=s;const o=this.element=document.createElement("div");o.setAttribute("id",n),o.classList.add(t),s.shadowRoot.appendChild(o),this.init(i)}init(){}dispose(){}get bounds(){return this.element.getBoundingClientRect()}get id(){return this.element.getAttribute("id")}createDiv(t){const e=document.createElement("div");return e.classList.add(t),this.element.appendChild(e),e}createSvg(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}remove(){this.dispose(),this.element.remove()}}export{m as FlowViewBase};class v extends m{static cssClassName="fv-edge";static width=2;static style={[`.${v.cssClassName}`]:{display:"inline-block",position:"absolute",border:0},[`.${v.cssClassName} line`]:{stroke:a.connectionColor,"stroke-width":v.width},[`.${v.cssClassName} line:hover`]:{stroke:a.connectionColorHighlighted}};init({source:t,target:e}){this.source=t,this.target=e;const s=this.svg=this.createSvg("svg");this.element.appendChild(s);const i=this.line=this.createSvg("line");s.appendChild(i),this.updateGeometry(),this._onPointerdownLine=this.onPointerdownLine.bind(this),this.line.addEventListener("pointerdown",this._onPointerdownLine)}dispose(){this.line.removeEventListener("pointerdown",this._onPointerdownLine)}set start({x:t,y:e}){this.line.setAttribute("x1",Math.round(t)),this.line.setAttribute("y1",Math.round(e))}set end({x:t,y:e}){this.line.setAttribute("x2",Math.round(t)),this.line.setAttribute("y2",Math.round(e))}set dimension([t,e]){const{element:{style:s},svg:i}=this,n=Math.round(t),o=Math.round(e);s.width=`${n}px`,s.height=`${o}px`,i.setAttribute("width",n),i.setAttribute("height",o)}set position({x:t,y:e}){const{element:{style:s}}=this;s.top=`${Math.round(e)}px`,s.left=`${Math.round(t)}px`}onPointerdownLine(){this.view.deleteEdge(this.id)}onViewOriginUpdate(){this.updateGeometry()}updateGeometry(){const{source:{center:{x:t,y:e}},target:{center:{x:s,y:i}},view:{origin:{x:n,y:o}}}=this,l=s<t,c=i<e;this.position={x:(l?s:t)-n,y:(c?i:e)-o};const u=Math.abs(s-t),f=Math.abs(i-e);this.dimension=[u,f],this.start={x:l?u:0,y:c?f:0},this.end={x:l?0:u,y:c?0:f}}}export{v as FlowViewEdge};class r extends m{static cssClassName="fv-pin";static size=10;static style={[`.${r.cssClassName}`]:{"background-color":a.connectionColor,display:"block",width:`${r.size}px`,height:`${r.size}px`},[`.${r.cssClassName}:hover`]:{"background-color":a.connectionColorHighlighted}};init({node:t}){this.node=t,this._onPointerdown=this.onPointerdown.bind(this),this.element.addEventListener("pointerdown",this._onPointerdown)}get halfPinSize(){return Math.round(r.size/2)}dispose(){this.element.removeEventListener("pointerdown",this._onPointerdown)}onPointerdown(t){t.stopPropagation()}}export{r as FlowViewPin};class N extends r{get center(){const{halfPinSize:t,node:{position:{x:e,y:s}}}=this;return{x:e+t,y:s+t}}}class P extends r{get center(){const{halfPinSize:t,node:{borderWidth:e,bounds:{height:s},position:{x:i,y:n}}}=this;return{x:i+t+e,y:n+s-t-e}}}class h extends m{static cssClassName="fv-node";static borderWidth=1;static minSize=r.size*4;static style={[`.${h.cssClassName}`]:{position:"absolute","background-color":a.nodeBackgroundColor,"box-shadow":a.boxShadow,display:"flex","flex-direction":"column","justify-content":"space-between",border:`${h.borderWidth}px solid transparent`,"min-height":`${h.minSize}px`,"min-width":`${h.minSize}px`,width:"fit-content"},[`.${h.cssClassName} .label`]:{"user-select":"none","padding-left":"0.5em","padding-right":"0.5em"},[`.${h.cssClassName} .pins`]:{display:"flex","flex-direction":"row","justify-content":"space-between",height:`${r.size}px`}};init({label:t,inputs:e=[],outputs:s=[],x:i,y:n}){this.borderWidth=h.borderWidth,this._inputs=new Map,this.inputListDiv=this.createDiv("pins");for(const o of e)this.newInput(o);this.labelDiv=this.createDiv("label"),this.label=t,this._outputs=new Map,this.outputListDiv=this.createDiv("pins");for(const o of s)this.newOutput(o);this.position={x:i,y:n},this._onPointerdown=this.onPointerdown.bind(this),this.element.addEventListener("pointerdown",this._onPointerdown)}dispose(){this.element.removeEventListener("pointerdown",this._onPointerdown)}get label(){return this.labelDiv.textContent}set label(t){this.labelDiv.textContent=t}get inputs(){return Array.from(this._inputs.values())}get outputs(){return Array.from(this._outputs.values())}get position(){return{x:this.x,y:this.y}}set position({x:t=0,y:e=0}={}){const{element:s,view:i}=this;this.x=t,this.y=e,s.style.top=`${e-i.origin.y}px`,s.style.left=`${t-i.origin.x}px`}deleteInput(t){this._inputs.get(t).remove(),this._inputs.delete(t)}deleteOutput(t){this._outputs.get(t).remove(),this._outputs.delete(t)}input(t){return this._inputs.get(t)}output(t){return this._outputs.get(t)}onViewOriginUpdate(){const{x:t,y:e}=this.position;this.position={x:t,y:e}}newInput({id:t}){const e=new N({id:t,node:this,view:this.view,cssClassName:r.cssClassName});this._inputs.set(e.id,e),this.inputListDiv.appendChild(e.element)}newOutput({id:t}){const e=new P({id:t,node:this,view:this.view,cssClassName:r.cssClassName});this._outputs.set(e.id,e),this.outputListDiv.appendChild(e.element)}onPointerdown(t){t.stopPropagation()}}export{h as FlowViewNode};class w extends m{static cssClassName="fv-selector";static style={[`.${w.cssClassName}`]:{position:"absolute","box-shadow":a.boxShadow},[`.${w.cssClassName} input`]:{border:0}};init({position:t}){this.element.setAttribute("tabindex",0);const e=this.input=document.createElement("input");this.element.appendChild(e),this.position=t,this._onKeydown=this.onKeydown.bind(this),this.element.addEventListener("keydown",this._onKeydown)}dispose(){this.element.removeEventListener("keydown",this._onKeydown)}focus(){this.input.focus()}set position({x:t,y:e}){const{element:s,view:i}=this;s.style.top=`${e-i.origin.y}px`,s.style.left=`${t-i.origin.x}px`}onKeydown(t){switch(t.stopPropagation(),!0){case t.code==="Tab":{t.preventDefault();break}default:}}}class d extends HTMLElement{static customElementName="flow-view";static minHeight=200;static style={":host([hidden])":{display:"none"},":host":{...E,position:"relative",display:"block",overflow:"hidden",border:0,margin:0,"background-color":a.backgroundColor,"box-shadow":a.boxShadow,"font-family":a.fontFamily,"font-size":a.fontSize,color:a.textColor},...v.style,...h.style,...r.style,...w.style};static generateStylesheet(t){return Object.entries(t).reduce((e,[s,i])=>[e,`${s} {`,Object.entries(i).map(([n,o])=>`  ${n}: ${o};`).join(`
`),"}"].join(`
`),"")}static pointerCoordinates(t){const{clientX:e,clientY:s,target:i}=t,{left:n,top:o}=i.getBoundingClientRect(),l=Math.round(e-n),c=Math.round(s-o);return{x:l,y:c}}constructor(){super();const t=document.createElement("template");t.innerHTML=`<style>${d.generateStylesheet(d.style)}</style>`,this.attachShadow({mode:"open"}).appendChild(t.content.cloneNode(!0)),this._origin={x:0,y:0},this._nodes=new Map,this._edges=new Map}connectedCallback(){this.canResize?(this.rootResizeObserver=new ResizeObserver(this.onRootResize.bind(this)),this.rootResizeObserver.observe(this.parentNode)):this.height=this.getAttribute("height")||d.minHeight,this.getAttribute("tabindex")||this.setAttribute("tabindex",0),this.addEventListener("dblclick",this.onDblclick),this.addEventListener("keydown",this.onKeydown),this.addEventListener("pointerdown",this.onPointerdown),this.addEventListener("pointermove",this.onPointermove),this.addEventListener("pointerleave",this.onPointerleave),this.addEventListener("pointerup",this.onPointerup)}disconnectedCallback(){this.canResize&&this.rootResizeObserver.unobserve(this.parentNode),this.removeEventListener("dblclick",this.onDblclick),this.removeEventListener("keydown",this.onKeydown),this.removeEventListener("pointerdown",this.onPointerdown),this.removeEventListener("pointermove",this.onPointermove),this.removeEventListener("pointerleave",this.onPointerleave),this.removeEventListener("pointerup",this.onPointerup)}get canResize(){return"ResizeObserver"in window}get origin(){return this.translateVector?{x:this._origin.x+this.translateVector.x,y:this._origin.y+this.translateVector.y}:this._origin}get edges(){return Array.from(this._edges.values())}get nodes(){return Array.from(this._nodes.values())}set width(t){this.style.width=`${t}px`}set height(t){this.style.height=`${t}px`}addEdge(t){this._edges.set(t.id,t)}addNode(t){this._nodes.set(t.id,t)}deleteEdge(t){this._edges.get(t).remove(),this._edges.delete(t)}deleteNode(t){const e=this._nodes.get(t);for(const s of this.edges)(s.sourceNodeId===t||s.targetNodeId===t)&&this.deleteEdge(s.id);e.remove(),this._nodes.delete(t)}edge(t){return this._edges.get(t)}node(t){return this._nodes.get(t)}startTranslate(t){this.startDraggingPoint=d.pointerCoordinates(t),this.translateVector={x:0,y:0}}stopTranslate(){this.translateVector&&(this._origin={x:this._origin.x+this.translateVector.x,y:this._origin.y+this.translateVector.y},this.translateVector=void 0),this.startDraggingPoint=void 0}onDblclick(t){const e=d.pointerCoordinates(t);this.selector&&this.selector.remove(),(this.selector=new w({id:"selector",view:this,cssClassName:w.cssClassName,position:e})).focus()}onKeydown(t){switch(t.stopPropagation(),!0){case typeof this.selector!="undefined":return;case t.code==="Backspace":{this.deleteSelection();break}case"KeyU":{this.undo();break}case"KeyR":{this.redo();break}default:}}onPointerdown(t){this.startTranslate(t)}onPointermove(t){const{startDraggingPoint:e}=this;if(e){const s=d.pointerCoordinates(t);this.translateVector={x:e.x-s.x,y:e.y-s.y};for(const i of this.nodes)i.onViewOriginUpdate();for(const i of this.edges)i.onViewOriginUpdate()}}onPointerleave(){this.stopTranslate()}onPointerup(){this.stopTranslate()}onRootResize(t){for(const e of t){const s=Array.isArray(e.contentBoxSize)?e.contentBoxSize[0]:e.contentBoxSize;this.width=s.inlineSize,this.height=s.blockSize-10}}deleteSelection(){}undo(){}redo(){}}export{d as FlowViewElement};class y{static defaultItems={edge:v,node:h};static defineCustomElement(){const{customElementName:t}=d;window.customElements.get(t)||window.customElements.define(t,d)}constructor({container:t,element:e}={}){y.defineCustomElement();const s=this.itemClass=new Map;Object.entries(y.defaultItems).forEach(([i,n])=>{s.set(i,n)}),e instanceof d?this.view=e:(this.view=document.createElement(d.customElementName),e.parentNode||(t instanceof HTMLElement?t.appendChild(e):document.body.appendChild(e)))}clearGraph(){this.view.nodes.clear(),this.view.edges.clear()}loadGraph({nodes:t=[],edges:e=[]}){if(!Array.isArray(t)||!Array.isArray(e))throw new TypeError("Invalid graph");for(const s of t)this.newNode(s);for(const s of e)this.newEdge(s)}newEdge({id:t,from:[e,s],to:[i,n]}){const o=this.view.node(e),l=this.view.node(i),c=o.output(s),u=l.input(n),f=this.itemClass.get("edge"),b=new f({id:t,view:this.view,cssClassName:f.cssClassName,source:c,target:u});return this.view.addEdge(b),b}newNode({x:t=0,y:e=0,label:s="node",id:i,nodeType:n="node",inputs:o=[],outputs:l=[]}={}){const c=this.itemClass.get(n),u=new c({id:i,view:this.view,cssClassName:c.cssClassName,label:s,inputs:o,outputs:l,x:t,y:e});return this.view.addNode(u),u}}export{y as FlowView};
