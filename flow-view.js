var H=Object.defineProperty,K=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var _=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var D=(o,e,t)=>e in o?H(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,u=(o,e)=>{for(var t in e||(e={}))R.call(e,t)&&D(o,t,e[t]);if(_)for(var t of _(e))O.call(e,t)&&D(o,t,e[t]);return o},k=(o,e)=>K(o,X(e));var A=(o,e)=>{var t={};for(var s in o)R.call(o,s)&&e.indexOf(s)<0&&(t[s]=o[s]);if(o!=null&&_)for(var s of _(o))e.indexOf(s)<0&&O.call(o,s)&&(t[s]=o[s]);return t};var a=(o,e,t)=>(D(o,typeof e!="symbol"?e+"":e,t),t);const p=o=>`${o}--highlighted`,$=o=>({transition:`${o} 117ms ease-in-out`}),j=o=>`--fv-default-${o}`,b=o=>`var(--fv-${o}, var(${j(o)}))`,c={backgroundColor:b("background-color"),borderRadius:b("border-radius"),boxShadow:b("box-shadow"),connectionColor:b("connection-color"),connectionColorHighlighted:b(p("connection-color")),fontFamily:b("font-family"),fontSize:b("font-size"),nodeBackgroundColor:b("node-background-color"),nodeBorderColorHighlighted:b(p("node-border-color")),textColor:b("text-color")},W={"border-radius":"2px","font-family":"sans-serif","font-Size":"17px"},B={light:k(u({},W),{"background-color":"#fefefe","connection-color":"#ccc","box-shadow":"0px 0px 7px 1px rgba(0, 0, 0, 0.1)",[p("connection-color")]:"#717171","node-background-color":"#fefefe",[p("node-border-color")]:"#717171","text-color":"#111"}),dark:{"background-color":"#555","connection-color":"#aaa","box-shadow":"0px 0px 7px 1px rgba(117, 117, 117, 0.7)",[p("connection-color")]:"#ddd","node-background-color":"#212121",[p("node-border-color")]:"#efefef","text-color":"#bbb"}},M=o=>Object.entries(B[o]).reduce((e,[t,s])=>k(u({},e),{[j(t)]:s}),{});export{p as cssModifierHighlighted};export{$ as cssTransition};export{c as cssVar};export{B as cssDefault};export{M as cssTheme};class N{static generateId(e){const t=Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5);return e.shadowRoot.getElementById(t)?N.generateId(e):t}constructor(n){var r=n,{cssClassName:e,id:t,view:s}=r,i=A(r,["cssClassName","id","view"]);const d=t||N.generateId(s),h=this.element=document.createElement("div");h.setAttribute("id",d),h.classList.add(e),s.shadowRoot.appendChild(h),this.view=s,this._selected=!1,this.cssClassName=e,this.init(i)}init(){}dispose(){}get bounds(){return this.element.getBoundingClientRect()}get id(){return this.element.getAttribute("id")}set highlight(e){const t=p(this.cssClassName);e?this.element.classList.add(t):this.element.classList.remove(t)}get isSelected(){return this._selected}set selected(e){e?this._selected=!0:this._selected=!1}createDiv(e){const t=document.createElement("div");return t.classList.add(e),this.element.appendChild(t),t}createSvg(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}remove(){this.dispose(),this.element.remove()}toObject(){return{id:this.id}}}export{N as FlowViewBase};const P=class extends N{init({source:e,target:t}){this.source=e,this.target=t;const s=this.svg=this.createSvg("svg");this.element.appendChild(s);const i=this.line=this.createSvg("line");s.appendChild(i),this.updateGeometry(),this._onPointerdownLine=this.onPointerdownLine.bind(this),i.addEventListener("pointerdown",this._onPointerdownLine),this._onPointerenterLine=this.onPointerenterLine.bind(this),i.addEventListener("pointerenter",this._onPointerenterLine),this._onPointerleaveLine=this.onPointerleaveLine.bind(this),i.addEventListener("pointerleave",this._onPointerleaveLine)}dispose(){const{line:e}=this;e.removeEventListener("pointerdown",this._onPointerdownLine),e.removeEventListener("pointerenter",this._onPointerenterLine),e.removeEventListener("pointerleave",this._onPointerleaveLine)}set start({x:e,y:t}){this.line.setAttribute("x1",Math.round(e)),this.line.setAttribute("y1",Math.round(t))}set end({x:e,y:t}){this.line.setAttribute("x2",Math.round(e)),this.line.setAttribute("y2",Math.round(t))}set dimension([e,t]){const{padding:s}=P,{element:{style:i},svg:n}=this,r=e+s*2,d=t+s*2;i.width=`${r}px`,i.height=`${d}px`,n.setAttribute("width",r),n.setAttribute("height",d)}set position({x:e,y:t}){const{padding:s}=P,{element:{style:i}}=this;i.top=`${Math.round(t)-s}px`,i.left=`${Math.round(e)-s}px`}onPointerdownLine(e){e.stopPropagation(),e.shiftKey||this.view.clearSelection(),this.view.selectEdge(this)}onPointerenterLine(){this.isSelected||(this.highlight=!0,this.source.highlight=!0,this.target.highlight=!0)}onPointerleaveLine(){this.isSelected||(this.highlight=!1,this.source.node.isSelected||(this.source.highlight=!1),this.target.node.isSelected||(this.target.highlight=!1))}updateGeometry(){const{lineWidth:e,padding:t}=P,{source:{center:{x:s,y:i}},target:{center:{x:n,y:r}},view:{origin:{x:d,y:h}}}=this,l=n<s,E=r<i;this.position={x:(l?n:s)-d,y:(E?r:i)-h};const m=Math.max(Math.abs(Math.round(n-s)),e),L=Math.max(Math.abs(Math.round(r-i)),e);this.dimension=[m,L],this.start={x:(l?m:0)+t,y:(E?L:0)+t},this.end={x:(l?0:m)+t,y:(E?0:L)+t}}toObject(){const{source:e,target:t}=this,s=e.node.id,i=e.id,n=t.node.id,r=t.id;return k(u({},super.toObject()),{from:[s,i],to:[n,r]})}};let v=P;a(v,"cssClassName","fv-edge"),a(v,"lineWidth",2),a(v,"padding",1),a(v,"zIndex",0),a(v,"style",{[`.${P.cssClassName}`]:{display:"inline-block",position:"absolute",border:0,"pointer-events":"none"},[`.${P.cssClassName} line`]:u({"pointer-events":"all",stroke:c.connectionColor,"stroke-width":P.lineWidth},$("stroke")),[`.${p(P.cssClassName)} line`]:{stroke:c.connectionColorHighlighted}});export{v as FlowViewEdge};const S=class extends N{init({node:e}){this.node=e,this._onPointerdown=this.onPointerdown.bind(this),this.element.addEventListener("pointerdown",this._onPointerdown),this._onPointerenter=this.onPointerenter.bind(this),this.element.addEventListener("pointerenter",this._onPointerenter),this._onPointerleave=this.onPointerleave.bind(this),this.element.addEventListener("pointerleave",this._onPointerleave)}get halfPinSize(){return Math.round(S.size/2)}dispose(){this.element.removeEventListener("pointerdown",this._onPointerdown),this.element.removeEventListener("pointerenter",this._onPointerenter),this.element.removeEventListener("pointerleave",this._onPointerleave)}onPointerdown(e){e.stopPropagation()}onPointerenter(e){e.stopPropagation(),this.highlight=!0}onPointerleave(e){e.stopPropagation(),this.highlight=!1}};let g=S;a(g,"cssClassName","fv-pin"),a(g,"size",10),a(g,"style",{[`.${S.cssClassName}`]:u({"background-color":c.connectionColor,display:"block",width:`${S.size}px`,height:`${S.size}px`},$("background-color")),[`.${p(S.cssClassName)}`]:{"background-color":c.connectionColorHighlighted}});export{g as FlowViewPin};class G extends g{get center(){const{bounds:{x:e},halfPinSize:t,node:{borderWidth:s,bounds:{x:i},position:{x:n,y:r}}}=this,d=e-i;return{x:n+t+s+d,y:r+t-s}}}class Y extends g{get center(){const{bounds:{x:e},halfPinSize:t,node:{borderWidth:s,bounds:{height:i,x:n},position:{x:r,y:d}}}=this,h=e-n;return{x:r+t+s+h,y:d+i-t-s}}}const f=class extends N{init({label:e,inputs:t=[],outputs:s=[],x:i,y:n}){const{element:r}=this;this.borderWidth=f.borderWidth,this._inputs=new Map,this.inputListDiv=this.createDiv("pins");for(const d of t)this.newInput(d);this.labelDiv=this.createDiv("label"),this.label=e,this._outputs=new Map,this.outputListDiv=this.createDiv("pins");for(const d of s)this.newOutput(d);this.position={x:i,y:n},this._onDblclick=this.onDblclick.bind(this),r.addEventListener("dblclick",this._onDblclick),this._onPointerdown=this.onPointerdown.bind(this),r.addEventListener("pointerdown",this._onPointerdown)}dispose(){const{element:e}=this;e.removeEventListener("dblclick",this._onDblclick),e.removeEventListener("pointerdown",this._onPointerdown)}get label(){return this.labelDiv.textContent}set label(e){this.labelDiv.textContent=e}get inputs(){return Array.from(this._inputs.values())}get outputs(){return Array.from(this._outputs.values())}get position(){return{x:this.x,y:this.y}}set position({x:e=0,y:t=0}={}){const{element:s,view:i}=this;this.x=e,this.y=t,s.style.top=`${t-i.origin.y}px`,s.style.left=`${e-i.origin.x}px`}deleteInput(e){this._inputs.get(e).remove(),this._inputs.delete(e)}deleteOutput(e){this._outputs.get(e).remove(),this._outputs.delete(e)}input(e){return this._inputs.get(e)}output(e){return this._outputs.get(e)}newInput({id:e}){const t=new G({id:e,node:this,view:this.view,cssClassName:g.cssClassName});this._inputs.set(t.id,t),this.inputListDiv.appendChild(t.element)}newOutput({id:e}){const t=new Y({id:e,node:this,view:this.view,cssClassName:g.cssClassName});this._outputs.set(t.id,t),this.outputListDiv.appendChild(t.element)}onDblclick(e){e.stopPropagation()}onPointerdown(e){e.isBubblingFromNode=!0,e.shiftKey||this.view.hasSelectedNodes&&this.isSelected||this.view.clearSelection(),this.view.selectNode(this)}toObject(){return u({},super.toObject())}};let x=f;a(x,"cssClassName","fv-node"),a(x,"borderWidth",1),a(x,"minSize",g.size*4),a(x,"zIndex",v.zIndex+1),a(x,"style",{[`.${f.cssClassName}`]:u({position:"absolute","background-color":c.nodeBackgroundColor,"border-radius":c.borderRadius,"box-shadow":c.boxShadow,display:"flex","flex-direction":"column","justify-content":"space-between",border:`${f.borderWidth}px solid transparent`,"min-height":`${f.minSize}px`,"min-width":`${f.minSize}px`,width:"fit-content","z-index":f.zIndex},$("border-color")),[`.${p(f.cssClassName)}`]:{"border-color":c.nodeBorderColorHighlighted},[`.${f.cssClassName} .label`]:{"user-select":"none","padding-left":"0.5em","padding-right":"0.5em"},[`.${f.cssClassName} .pins`]:{display:"flex","flex-direction":"row","justify-content":"space-between",height:`${g.size}px`}});export{x as FlowViewNode};const z=class extends N{init({position:e}){const{element:t}=this;t.setAttribute("tabindex",0);const s=this.input=document.createElement("input");t.appendChild(s),this.position=e,this._onDblclick=this.onDblclick.bind(this),t.addEventListener("dblclick",this._onDblclick),this._onKeydown=this.onKeydown.bind(this),t.addEventListener("keydown",this._onKeydown),this._onPointerdown=this.onPointerdown.bind(this),t.addEventListener("pointerdown",this._onPointerdown)}dispose(){const{element:e}=this;e.removeEventListener("dblclick",this._onDblclick),e.removeEventListener("keydown",this._onKeydown),e.removeEventListener("pointerdown",this._onPointerdown)}focus(){this.input.focus()}set position({x:e,y:t}){const{element:s,view:i}=this;s.style.top=`${t-i.origin.y}px`,s.style.left=`${e-i.origin.x}px`,this.x=e,this.y=t}get position(){return{x:this.x,y:this.y}}onDblclick(e){e.stopPropagation()}onKeydown(e){switch(e.stopPropagation(),!0){case e.code==="Enter":{const{x:t,y:s}=this.position;this.view.newNode({x:t,y:s,label:this.input.value}),this.view.removeSelector();break}case e.code==="Escape":{this.view.removeSelector();break}case e.code==="Tab":{e.preventDefault();break}default:}}onPointerdown(e){e.stopPropagation()}};let C=z;a(C,"cssClassName","fv-selector"),a(C,"zIndex",x.zIndex+1),a(C,"style",{[`.${z.cssClassName}`]:{position:"absolute","box-shadow":c.boxShadow},[`.${z.cssClassName} input`]:{border:0,margin:0,outline:0,"border-radius":c.borderRadius,"font-family":c.fontFamily,"font-size":c.fontSize,padding:"0.5em","z-index":z.zIndex}});const y=class extends HTMLElement{static generateStylesheet(e){return Object.entries(e).reduce((t,[s,i])=>[t,`${s} {`,Object.entries(i).map(([n,r])=>`  ${n}: ${r};`).join(`
`),"}"].join(`
`),"")}static pointerCoordinates(e){const{clientX:t,clientY:s,target:i}=e,{left:n,top:r}=i.getBoundingClientRect(),d=Math.round(t-n),h=Math.round(s-r);return{x:d,y:h}}constructor(){super();const e=document.createElement("template");e.innerHTML=["<style>",y.generateStylesheet(y.style),"@media (prefers-color-scheme: dark) {",y.generateStylesheet({":host":M("dark")}),"}","</style>"].join(`
`),this.attachShadow({mode:"open"}).appendChild(e.content.cloneNode(!0)),this._origin={x:0,y:0},this._nodes=new Map,this._edges=new Map;const t=this.itemClass=new Map;Object.entries(y.defaultItems).forEach(([s,i])=>{t.set(s,i)})}get host(){return this._host||{viewChange:()=>{}}}set host(e){this._host=e}connectedCallback(){this.canResize?(this.rootResizeObserver=new ResizeObserver(this.onRootResize.bind(this)),this.rootResizeObserver.observe(this.parentNode)):this.height=this.getAttribute("height")||y.minHeight,this.getAttribute("tabindex")||this.setAttribute("tabindex",0),this.addEventListener("dblclick",this.onDblclick),this.addEventListener("keydown",this.onKeydown),this.addEventListener("pointerdown",this.onPointerdown),this.addEventListener("pointermove",this.onPointermove),this.addEventListener("pointerleave",this.onPointerleave),this.addEventListener("pointerup",this.onPointerup)}disconnectedCallback(){this.canResize&&this.rootResizeObserver.unobserve(this.parentNode),this.removeEventListener("dblclick",this.onDblclick),this.removeEventListener("keydown",this.onKeydown),this.removeEventListener("pointerdown",this.onPointerdown),this.removeEventListener("pointermove",this.onPointermove),this.removeEventListener("pointerleave",this.onPointerleave),this.removeEventListener("pointerup",this.onPointerup)}get canResize(){return"ResizeObserver"in window}get origin(){return this.translateVector&&!this.hasSelectedNodes?{x:this._origin.x+this.translateVector.x,y:this._origin.y+this.translateVector.y}:this._origin}get selectedEdges(){return this.edges.filter(e=>e.isSelected)}get hasSelectedNodes(){return this.selectedNodes.length>0}get selectedNodeIds(){return this.selectedNodes.map(e=>e.id)}get selectedNodes(){return this.nodes.filter(e=>e.isSelected)}get edges(){return Array.from(this._edges.values())}get nodes(){return Array.from(this._nodes.values())}set width(e){this.style.width=`${e}px`}set height(e){this.style.height=`${e}px`}newEdge({id:e,source:t,target:s}){const i=this.itemClass.get("edge"),n=new i({id:e,view:this,cssClassName:i.cssClassName,source:t,target:s});return this.addEdge(n),this.host.onChange({newEdges:[n.toObject()]}),n}newNode({x:e=0,y:t=0,label:s="node",id:i,nodeType:n="node",inputs:r=[],outputs:d=[]}){const h=this.itemClass.get(n),l=new h({id:i,view:this,cssClassName:h.cssClassName,label:s,inputs:r,outputs:d,x:e,y:t});return this.addNode(l),this.host.onChange({newNodes:[l.toObject()]}),l}selectEdge(e){e.highlight=!0,e.selected=!0,e.source.highlight=!0,e.target.highlight=!0}selectNode(e){e.highlight=!0,e.selected=!0;for(const t of e.inputs)t.highlight=!0;for(const t of e.outputs)t.highlight=!0;for(const t of this.edges)t.source.node.isSelected&&t.target.node.isSelected?this.selectEdge(t):this.deselectEdge(t)}deselectEdge(e){e.highlight=!1,e.selected=!1,e.source.node.isSelected||(e.source.highlight=!1),e.target.node.isSelected||(e.target.highlight=!1)}deselectNode(e){e.highlight=!1,e.selected=!1;for(const t of e.inputs)t.highlight=!1;for(const t of e.outputs)t.highlight=!1}addEdge(e){this._edges.set(e.id,e)}addNode(e){this._nodes.set(e.id,e)}deleteEdge(e){this._edges.delete(e.id),e.source.highlight=!1,e.target.highlight=!1,this.host.onChange({deletedEdges:[e.toObject()]}),e.remove()}deleteNode(e){const t=[];for(const s of this.edges)(s.source.node.id===e.id||s.target.node.id===e.id)&&(this.deleteEdge(s),t.push(s.toObject()));this._nodes.delete(e.id),this.host.onChange({deletedEdges:t,deletedNodes:[e.toObject()]}),e.remove()}edge(e){return this._edges.get(e)}node(e){return this._nodes.get(e)}startTranslate(e){if(this.startDraggingPoint=y.pointerCoordinates(e),this.translateVector={x:0,y:0},this.hasSelectedNodes){const t={};for(const s of this.selectedNodes)t[s.id]=s.position;this.selectedNodesStartPosition=t}}stopTranslate(){this.translateVector&&!this.hasSelectedNodes&&(this._origin={x:this._origin.x+this.translateVector.x,y:this._origin.y+this.translateVector.y}),this.translateVector=void 0,this.startDraggingPoint=void 0,this.selectedNodesStartPosition=void 0}onDblclick(e){const{origin:t}=this;this.clearSelection(),this.removeSelector();const s=y.pointerCoordinates(e);(this.selector=new C({id:"selector",view:this,cssClassName:C.cssClassName,position:{x:s.x+t.x,y:s.y+t.y}})).focus()}onKeydown(e){switch(e.stopPropagation(),!0){case this.selector instanceof C:return;case e.code==="Backspace":{this.deleteSelectedItems();break}case e.code==="Escape":{this.clearSelection();break}case"KeyU":{this.undo();break}case"KeyR":{this.redo();break}default:}}onPointerdown(e){e.stopPropagation(),this.removeSelector(),e.isBubblingFromNode||this.clearSelection(),this.startTranslate(e)}onPointermove(e){const{startDraggingPoint:t}=this;if(t){const{edges:s,nodes:i}=this,n=y.pointerCoordinates(e),r=t.x-n.x,d=t.y-n.y;if(this.translateVector={x:r,y:d},this.hasSelectedNodes){const{selectedNodes:h,selectedNodeIds:l,selectedNodesStartPosition:E}=this;for(const m of h){const{x:L,y:T}=E[m.id];m.position={x:L-r,y:T-d}}for(const m of s)(l.includes(m.source.node.id)||l.includes(m.target.node.id))&&m.updateGeometry()}else{for(const h of i){const{x:l,y:E}=h.position;h.position={x:l,y:E}}for(const h of s)h.updateGeometry()}}}onPointerleave(){this.stopTranslate()}onPointerup(){this.stopTranslate()}onRootResize(e){for(const t of e)if(this.parentNode===t.target){const s=Array.isArray(t.contentBoxSize)?t.contentBoxSize[0]:t.contentBoxSize;s?(this.width=s.inlineSize,this.height=s.blockSize-10):t.contentRect&&(this.width=t.contentRect.width,this.height=t.contentRect.height)}}clearSelection(){for(const e of this.selectedNodes)this.deselectNode(e);for(const e of this.selectedEdges)this.deselectEdge(e)}deleteSelectedItems(){for(const e of this.selectedEdges)this.deleteEdge(e);for(const e of this.selectedNodes)this.deleteNode(e)}removeSelector(){const{selector:e}=this;e instanceof C&&e.remove(),this.selector=void 0}undo(){}redo(){}};let w=y;a(w,"customElementName","flow-view"),a(w,"minHeight",200),a(w,"defaultItems",{edge:v,node:x}),a(w,"style",u(u(u(u({":host([hidden])":{display:"none"},":host":k(u({},M("light")),{position:"relative",display:"block",overflow:"hidden",border:0,margin:0,outline:0,"background-color":c.backgroundColor,"border-radius":c.borderRadius,"box-shadow":c.boxShadow,"font-family":c.fontFamily,"font-size":c.fontSize,color:c.textColor})},v.style),x.style),g.style),C.style));export{w as FlowViewElement};class I{static defineCustomElement(){const{customElementName:e}=w;window.customElements.get(e)||window.customElements.define(e,w)}constructor({container:e,element:t}={}){if(I.defineCustomElement(),t instanceof w)t.host=this,this.view=t;else{const s=this.view=document.createElement(w.customElementName);s.host=this,e instanceof HTMLElement?e.appendChild(s):document.body.appendChild(s)}this._onViewChange=()=>{}}clearGraph(){this.view.nodes.clear(),this.view.edges.clear()}loadGraph({nodes:e=[],edges:t=[]}){if(!Array.isArray(e)||!Array.isArray(t))throw new TypeError("Invalid graph");for(const s of e)this.newNode(s);for(const s of t)this.newEdge(s)}get onViewChange(){return this._onViewChange}onChange(e){typeof e=="function"&&(this._onViewChange=e)}viewChange(e){this.onViewChange(e)}newEdge({id:e,from:[t,s],to:[i,n]}){const r=this.view.node(t),d=this.view.node(i),h=r.output(s),l=d.input(n);return this.view.newEdge({id:e,source:h,target:l})}newNode({id:e,label:t,nodeType:s,inputs:i,outputs:n,x:r,y:d}={}){return this.view.newNode({id:e,label:t,nodeType:s,inputs:i,outputs:n,x:r,y:d})}}export{I as FlowView};
