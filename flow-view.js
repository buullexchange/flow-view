const g=c=>`${c}--highlighted`,N=c=>`--fv-default-${c}`,p=c=>`var(--fv-${c}, var(${N(c)}))`,r={backgroundColor:p("background-color"),borderRadius:p("border-radius"),boxShadow:p("box-shadow"),connectionColor:p("connection-color"),connectionColorHighlighted:p(g("connection-color")),fontFamily:p("font-family"),fontSize:p("font-size"),nodeBackgroundColor:p("node-background-color"),nodeBorderColorHighlighted:p(g("node-border-color")),textColor:p("text-color")},k={"border-radius":"2px","font-family":"sans-serif","font-Size":"17px"},E={light:{...k,"background-color":"#fefefe","connection-color":"#ccc","box-shadow":"0px 0px 7px 1px rgba(0, 0, 0, 0.1)",[g("connection-color")]:"#717171","node-background-color":"#fefefe",[g("node-border-color")]:"#717171","text-color":"#111"},dark:{"background-color":"#121212","connection-color":"#ccc","box-shadow":"0px 0px 7px 1px rgba(0, 0, 0, 0.1)",[g("connection-color")]:"#717171","node-background-color":"#fefefe","text-color":"#111"}},y=c=>Object.entries(E[c]).reduce((e,[t,s])=>({...e,[N(t)]:s}),{});export{g as cssModifierHighlighted};export{r as cssVar};export{E as cssDefault};export{y as cssTheme};class v{static generateId(e){const t=Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5);return e.shadowRoot.getElementById(t)?v.generateId(e):t}constructor({cssClassName:e,id:t,view:s,...i}){this.cssClassName=e;const o=t||v.generateId(s);this.view=s;const n=this.element=document.createElement("div");n.setAttribute("id",o),n.classList.add(e),s.shadowRoot.appendChild(n),this.init(i)}init(){}dispose(){}get bounds(){return this.element.getBoundingClientRect()}get id(){return this.element.getAttribute("id")}set highlight(e){const t=g(this.cssClassName);e?this.element.classList.add(t):this.element.classList.remove(t)}createDiv(e){const t=document.createElement("div");return t.classList.add(e),this.element.appendChild(t),t}createSvg(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}remove(){this.dispose(),this.element.remove()}}export{v as FlowViewBase};class m extends v{static cssClassName="fv-edge";static width=2;static style={[`.${m.cssClassName}`]:{display:"inline-block",position:"absolute",border:0},[`.${m.cssClassName} line`]:{stroke:r.connectionColor,"stroke-width":m.width},[`.${m.cssClassName} line:hover, .${g(m.cssClassName)} line`]:{stroke:r.connectionColorHighlighted}};init({source:e,target:t}){this.source=e,this.target=t;const s=this.svg=this.createSvg("svg");this.element.appendChild(s);const i=this.line=this.createSvg("line");s.appendChild(i),this.updateGeometry(),this._onPointerdownLine=this.onPointerdownLine.bind(this),this.line.addEventListener("pointerdown",this._onPointerdownLine)}dispose(){this.line.removeEventListener("pointerdown",this._onPointerdownLine)}set start({x:e,y:t}){this.line.setAttribute("x1",Math.round(e)),this.line.setAttribute("y1",Math.round(t))}set end({x:e,y:t}){this.line.setAttribute("x2",Math.round(e)),this.line.setAttribute("y2",Math.round(t))}set dimension([e,t]){const{element:{style:s},svg:i}=this,o=Math.round(e),n=Math.round(t);s.width=`${o}px`,s.height=`${n}px`,i.setAttribute("width",o),i.setAttribute("height",n)}set position({x:e,y:t}){const{element:{style:s}}=this;s.top=`${Math.round(t)}px`,s.left=`${Math.round(e)}px`}onPointerdownLine(e){e.stopPropagation(),this.view.selectEdge(this)}onViewOriginUpdate(){this.updateGeometry()}updateGeometry(){const{source:{center:{x:e,y:t}},target:{center:{x:s,y:i}},view:{origin:{x:o,y:n}}}=this,u=s<e,l=i<t;this.position={x:(u?s:e)-o,y:(l?i:t)-n};const f=Math.abs(s-e),b=Math.abs(i-t);this.dimension=[f,b],this.start={x:u?f:0,y:l?b:0},this.end={x:u?0:f,y:l?0:b}}}export{m as FlowViewEdge};class d extends v{static cssClassName="fv-pin";static size=10;static style={[`.${d.cssClassName}`]:{"background-color":r.connectionColor,"border-radius":r.borderRadius,display:"block",width:`${d.size}px`,height:`${d.size}px`},[`.${d.cssClassName}:hover`]:{"background-color":r.connectionColorHighlighted}};init({node:e}){this.node=e,this._onPointerdown=this.onPointerdown.bind(this),this.element.addEventListener("pointerdown",this._onPointerdown)}get halfPinSize(){return Math.round(d.size/2)}dispose(){this.element.removeEventListener("pointerdown",this._onPointerdown)}onPointerdown(e){e.stopPropagation()}}export{d as FlowViewPin};class P extends d{get center(){const{halfPinSize:e,node:{position:{x:t,y:s}}}=this;return{x:t+e,y:s+e}}}class L extends d{get center(){const{halfPinSize:e,node:{borderWidth:t,bounds:{height:s},position:{x:i,y:o}}}=this;return{x:i+e+t,y:o+s-e-t}}}class h extends v{static cssClassName="fv-node";static borderWidth=1;static minSize=d.size*4;static style={[`.${h.cssClassName}`]:{position:"absolute","background-color":r.nodeBackgroundColor,"border-radius":r.borderRadius,"box-shadow":r.boxShadow,display:"flex","flex-direction":"column","justify-content":"space-between",border:`${h.borderWidth}px solid transparent`,"min-height":`${h.minSize}px`,"min-width":`${h.minSize}px`,width:"fit-content"},[`.${g(h.cssClassName)}`]:{"border-color":r.nodeBorderColorHighlighted},[`.${h.cssClassName} .label`]:{"user-select":"none","padding-left":"0.5em","padding-right":"0.5em"},[`.${h.cssClassName} .pins`]:{display:"flex","flex-direction":"row","justify-content":"space-between",height:`${d.size}px`}};init({label:e,inputs:t=[],outputs:s=[],x:i,y:o}){this.borderWidth=h.borderWidth,this._inputs=new Map,this.inputListDiv=this.createDiv("pins");for(const n of t)this.newInput(n);this.labelDiv=this.createDiv("label"),this.label=e,this._outputs=new Map,this.outputListDiv=this.createDiv("pins");for(const n of s)this.newOutput(n);this.position={x:i,y:o},this._onPointerdown=this.onPointerdown.bind(this),this.element.addEventListener("pointerdown",this._onPointerdown)}dispose(){this.element.removeEventListener("pointerdown",this._onPointerdown)}get label(){return this.labelDiv.textContent}set label(e){this.labelDiv.textContent=e}get inputs(){return Array.from(this._inputs.values())}get outputs(){return Array.from(this._outputs.values())}get position(){return{x:this.x,y:this.y}}set position({x:e=0,y:t=0}={}){const{element:s,view:i}=this;this.x=e,this.y=t,s.style.top=`${t-i.origin.y}px`,s.style.left=`${e-i.origin.x}px`}deleteInput(e){this._inputs.get(e).remove(),this._inputs.delete(e)}deleteOutput(e){this._outputs.get(e).remove(),this._outputs.delete(e)}input(e){return this._inputs.get(e)}output(e){return this._outputs.get(e)}onViewOriginUpdate(){const{x:e,y:t}=this.position;this.position={x:e,y:t}}newInput({id:e}){const t=new P({id:e,node:this,view:this.view,cssClassName:d.cssClassName});this._inputs.set(t.id,t),this.inputListDiv.appendChild(t.element)}newOutput({id:e}){const t=new L({id:e,node:this,view:this.view,cssClassName:d.cssClassName});this._outputs.set(t.id,t),this.outputListDiv.appendChild(t.element)}onPointerdown(e){e.stopPropagation(),this.view.selectNode(this)}}export{h as FlowViewNode};class x extends v{static cssClassName="fv-selector";static style={[`.${x.cssClassName}`]:{position:"absolute","box-shadow":r.boxShadow},[`.${x.cssClassName} input`]:{border:0}};init({position:e}){this.element.setAttribute("tabindex",0);const t=this.input=document.createElement("input");this.element.appendChild(t),this.position=e,this._onKeydown=this.onKeydown.bind(this),this.element.addEventListener("keydown",this._onKeydown)}dispose(){this.element.removeEventListener("keydown",this._onKeydown)}focus(){this.input.focus()}set position({x:e,y:t}){const{element:s,view:i}=this;s.style.top=`${t-i.origin.y}px`,s.style.left=`${e-i.origin.x}px`}onKeydown(e){switch(e.stopPropagation(),!0){case e.code==="Tab":{e.preventDefault();break}default:}}}class a extends HTMLElement{static customElementName="flow-view";static minHeight=200;static style={":host([hidden])":{display:"none"},":host":{...y("light"),position:"relative",display:"block",overflow:"hidden",border:0,margin:0,"background-color":r.backgroundColor,"box-shadow":r.boxShadow,"font-family":r.fontFamily,"font-size":r.fontSize,color:r.textColor},...m.style,...h.style,...d.style,...x.style};static generateStylesheet(e){return Object.entries(e).reduce((t,[s,i])=>[t,`${s} {`,Object.entries(i).map(([o,n])=>`  ${o}: ${n};`).join(`
`),"}"].join(`
`),"")}static pointerCoordinates(e){const{clientX:t,clientY:s,target:i}=e,{left:o,top:n}=i.getBoundingClientRect(),u=Math.round(t-o),l=Math.round(s-n);return{x:u,y:l}}constructor(){super();const e=document.createElement("template");e.innerHTML=["<style>",a.generateStylesheet(a.style),"@media (prefers-color-scheme: dark) {",a.generateStylesheet({":host":y("dark")}),"}","</style>"].join(`
`),this.attachShadow({mode:"open"}).appendChild(e.content.cloneNode(!0)),this._origin={x:0,y:0},this._nodes=new Map,this._edges=new Map,this.selectedNodes=new Set,this.selectedEdges=new Set}connectedCallback(){this.canResize?(this.rootResizeObserver=new ResizeObserver(this.onRootResize.bind(this)),this.rootResizeObserver.observe(this.parentNode)):this.height=this.getAttribute("height")||a.minHeight,this.getAttribute("tabindex")||this.setAttribute("tabindex",0),this.addEventListener("dblclick",this.onDblclick),this.addEventListener("keydown",this.onKeydown),this.addEventListener("pointerdown",this.onPointerdown),this.addEventListener("pointermove",this.onPointermove),this.addEventListener("pointerleave",this.onPointerleave),this.addEventListener("pointerup",this.onPointerup)}disconnectedCallback(){this.canResize&&this.rootResizeObserver.unobserve(this.parentNode),this.removeEventListener("dblclick",this.onDblclick),this.removeEventListener("keydown",this.onKeydown),this.removeEventListener("pointerdown",this.onPointerdown),this.removeEventListener("pointermove",this.onPointermove),this.removeEventListener("pointerleave",this.onPointerleave),this.removeEventListener("pointerup",this.onPointerup)}get canResize(){return"ResizeObserver"in window}get origin(){return this.translateVector?{x:this._origin.x+this.translateVector.x,y:this._origin.y+this.translateVector.y}:this._origin}get edges(){return Array.from(this._edges.values())}get nodes(){return Array.from(this._nodes.values())}set width(e){this.style.width=`${e}px`}set height(e){this.style.height=`${e}px`}selectEdge(e){e.highlight=!0,this.selectedEdges.add(e)}selectNode(e){e.highlight=!0,this.selectedNodes.add(e)}deselectEdge(e){e.highlight=!1,this.selectedEdges.delete(e)}deselectNode(e){e.highlight=!1,this.selectedNodes.delete(e)}addEdge(e){this._edges.set(e.id,e)}addNode(e){this._nodes.set(e.id,e)}deleteEdge(e){this._edges.get(e).remove(),this._edges.delete(e)}deleteNode(e){const t=this._nodes.get(e);for(const s of this.edges)(s.sourceNodeId===e||s.targetNodeId===e)&&this.deleteEdge(s.id);t.remove(),this._nodes.delete(e)}edge(e){return this._edges.get(e)}node(e){return this._nodes.get(e)}startTranslate(e){this.startDraggingPoint=a.pointerCoordinates(e),this.translateVector={x:0,y:0}}stopTranslate(){this.translateVector&&(this._origin={x:this._origin.x+this.translateVector.x,y:this._origin.y+this.translateVector.y},this.translateVector=void 0),this.startDraggingPoint=void 0}onDblclick(e){const t=a.pointerCoordinates(e);this.selector&&this.selector.remove(),(this.selector=new x({id:"selector",view:this,cssClassName:x.cssClassName,position:t})).focus()}onKeydown(e){switch(e.stopPropagation(),!0){case typeof this.selector!="undefined":return;case e.code==="Backspace":{this.deleteSelectedItems();break}case"KeyU":{this.undo();break}case"KeyR":{this.redo();break}default:}}onPointerdown(e){this.startTranslate(e)}onPointermove(e){const{startDraggingPoint:t}=this;if(t){const s=a.pointerCoordinates(e);this.translateVector={x:t.x-s.x,y:t.y-s.y};for(const i of this.nodes)i.onViewOriginUpdate();for(const i of this.edges)i.onViewOriginUpdate()}}onPointerleave(){this.stopTranslate()}onPointerup(){this.stopTranslate()}onRootResize(e){for(const t of e){const s=Array.isArray(t.contentBoxSize)?t.contentBoxSize[0]:t.contentBoxSize;this.width=s.inlineSize,this.height=s.blockSize-10}}clearSelection(){for(const e of this.selectedEdges)this.deselectEdge(e);for(const e of this.selectedNodes)this.deselectNode(e.id)}deleteSelectItems(){for(const e of this.selectedEdges)this.deleteEdge(e.id);this.selectedEdges.clear();for(const e of this.selectedNodes)this.deleteNode(e.id);this.selectedNodes.clear()}undo(){}redo(){}}export{a as FlowViewElement};class w{static defaultItems={edge:m,node:h};static defineCustomElement(){const{customElementName:e}=a;window.customElements.get(e)||window.customElements.define(e,a)}constructor({container:e,element:t}={}){w.defineCustomElement();const s=this.itemClass=new Map;Object.entries(w.defaultItems).forEach(([i,o])=>{s.set(i,o)}),t instanceof a?this.view=t:(this.view=document.createElement(a.customElementName),t.parentNode||(e instanceof HTMLElement?e.appendChild(t):document.body.appendChild(t)))}clearGraph(){this.view.nodes.clear(),this.view.edges.clear()}loadGraph({nodes:e=[],edges:t=[]}){if(!Array.isArray(e)||!Array.isArray(t))throw new TypeError("Invalid graph");for(const s of e)this.newNode(s);for(const s of t)this.newEdge(s)}newEdge({id:e,from:[t,s],to:[i,o]}){const n=this.view.node(t),u=this.view.node(i),l=n.output(s),f=u.input(o),b=this.itemClass.get("edge"),C=new b({id:e,view:this.view,cssClassName:b.cssClassName,source:l,target:f});return this.view.addEdge(C),C}newNode({x:e=0,y:t=0,label:s="node",id:i,nodeType:o="node",inputs:n=[],outputs:u=[]}={}){const l=this.itemClass.get(o),f=new l({id:i,view:this.view,cssClassName:l.cssClassName,label:s,inputs:n,outputs:u,x:e,y:t});return this.view.addNode(f),f}}export{w as FlowView};
