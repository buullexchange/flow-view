var V=Object.defineProperty,G=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var _=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var j=(d,e,t)=>e in d?V(d,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):d[e]=t,l=(d,e)=>{for(var t in e||(e={}))T.call(e,t)&&j(d,t,e[t]);if(_)for(var t of _(e))R.call(e,t)&&j(d,t,e[t]);return d},L=(d,e)=>G(d,Y(e));var B=(d,e)=>{var t={};for(var i in d)T.call(d,i)&&e.indexOf(i)<0&&(t[i]=d[i]);if(d!=null&&_)for(var i of _(d))e.indexOf(i)<0&&R.call(d,i)&&(t[i]=d[i]);return t};var a=(d,e,t)=>(j(d,typeof e!="symbol"?e+"":e,t),t);const f=d=>`${d}--highlighted`,z=d=>({transition:`${d} 117ms ease-in-out`}),K=d=>`--fv-default-${d}`,v=d=>`var(--fv-${d}, var(${K(d)}))`,c={backgroundColor:v("background-color"),borderRadius:v("border-radius"),boxShadow:v("box-shadow"),connectionColor:v("connection-color"),connectionColorHighlighted:v(f("connection-color")),fontFamily:v("font-family"),fontSize:v("font-size"),nodeBackgroundColor:v("node-background-color"),nodeBorderColorHighlighted:v(f("node-border-color")),textColor:v("text-color")},U={"border-radius":"2px","font-family":"sans-serif","font-Size":"17px"},H={light:L(l({},U),{"background-color":"#fefefe","connection-color":"#ccc","box-shadow":"0px 0px 7px 1px rgba(0, 0, 0, 0.1)",[f("connection-color")]:"#717171","node-background-color":"#fefefe",[f("node-border-color")]:"#717171","text-color":"#111"}),dark:{"background-color":"#555","connection-color":"#aaa","box-shadow":"0px 0px 7px 1px rgba(117, 117, 117, 0.7)",[f("connection-color")]:"#ddd","node-background-color":"#212121",[f("node-border-color")]:"#efefef","text-color":"#bbb"}},M=d=>Object.entries(H[d]).reduce((e,[t,i])=>L(l({},e),{[K(t)]:i}),{});export{f as cssModifierHighlighted};export{z as cssTransition};export{c as cssVar};export{H as cssDefault};export{M as cssTheme};class C{static generateId(e){const t=Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5);return e.shadowRoot.getElementById(t)?C.generateId(e):t}constructor(o){var n=o,{cssClassName:e,id:t,view:i}=n,s=B(n,["cssClassName","id","view"]);const r=t||C.generateId(i),h=this.element=document.createElement("div");h.setAttribute("id",r),h.classList.add(e),i.shadowRoot.appendChild(h),this.view=i,this._selected=!1,this.cssClassName=e,this.init(s)}init(){}dispose(){}get bounds(){return this.element.getBoundingClientRect()}get id(){return this.element.getAttribute("id")}set highlight(e){const t=f(this.cssClassName);e?this.element.classList.add(t):this.element.classList.remove(t)}get isSelected(){return this._selected}set selected(e){e?this._selected=!0:this._selected=!1}createDiv(e){const t=document.createElement("div");return t.classList.add(e),this.element.appendChild(t),t}createSvg(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}remove(){this.dispose(),this.element.remove()}toObject(){return{id:this.id}}}export{C as FlowViewBase};const S=class extends C{init({name:e,node:t,types:i}){this.name=e,this.node=t,this.types=i,this._onPointerdown=this.onPointerdown.bind(this),this.element.addEventListener("pointerdown",this._onPointerdown),this._onPointerenter=this.onPointerenter.bind(this),this.element.addEventListener("pointerenter",this._onPointerenter),this._onPointerleave=this.onPointerleave.bind(this),this.element.addEventListener("pointerleave",this._onPointerleave),this._onPointerup=this.onPointerup.bind(this),this.element.addEventListener("pointerup",this._onPointerup)}get halfPinSize(){return Math.round(S.size/2)}dispose(){this.element.removeEventListener("pointerdown",this._onPointerdown),this.element.removeEventListener("pointerenter",this._onPointerenter),this.element.removeEventListener("pointerleave",this._onPointerleave),this.element.removeEventListener("pointerup",this._onPointerup)}onPointerleave(e){e.stopPropagation(),this.highlight=!1}toObject(){const{name:e,types:t}=this,i={};return typeof e!="undefined"&&(i.name=e),typeof t!="undefined"&&(i.types=t),l(l({},super.toObject()),i)}};let p=S;a(p,"cssClassName","fv-pin"),a(p,"size",10),a(p,"style",{[`.${S.cssClassName}`]:l({"background-color":c.connectionColor,display:"block",width:`${S.size}px`,height:`${S.size}px`},z("background-color")),[`.${f(S.cssClassName)}`]:{"background-color":c.connectionColorHighlighted}});export{p as FlowViewPin};class O extends p{get center(){const{bounds:{x:e},halfPinSize:t,node:{borderWidth:i,bounds:{x:s},position:{x:o,y:n}}}=this,r=e-s;return{x:o+t+i+r,y:n+t-i}}onPointerdown(e){e.stopPropagation()}onPointerenter(e){e.stopPropagation(),!this.view.isDraggingEdge&&(this.highlight=!0)}onPointerup(){const{view:e}=this;if(e.isDraggingEdge){const{semiEdge:t}=e;if(t.hasSourcePin){const{source:i}=t;e.newEdge({source:i,target:this})}}}toObject(){return l({},super.toObject())}}class A extends p{get center(){const{bounds:{x:e},halfPinSize:t,node:{borderWidth:i,bounds:{height:s,x:o},position:{x:n,y:r}}}=this,h=e-o;return{x:n+t+i+h,y:r+s-t-i}}onPointerdown(e){e.isBubblingFromPin=!0,this.view.createSemiEdge({source:this})}onPointerenter(e){e.stopPropagation(),!this.view.isDraggingEdge&&(this.highlight=!0)}onPointerup(e){}toObject(){return l({},super.toObject())}}const k=class extends C{get hasSourcePin(){return this.source instanceof A}get hasTargetPin(){return this.target instanceof O}get isSemiEdge(){return!this.hasTargetPin||!this.hasSourcePin}init({source:e,target:t}){const i=e instanceof A,s=t instanceof O;this.source=s&&!i?{center:{x:t.center.x,y:t.center.y}}:e,this.target=i&&!s?{center:{x:e.center.x,y:e.center.y}}:t;const o=this.svg=this.createSvg("svg");this.element.appendChild(o);const n=this.line=this.createSvg("line");o.appendChild(n),this.updateGeometry(),this._onPointerdownLine=this.onPointerdownLine.bind(this),n.addEventListener("pointerdown",this._onPointerdownLine),this._onPointerenterLine=this.onPointerenterLine.bind(this),n.addEventListener("pointerenter",this._onPointerenterLine),this._onPointerleaveLine=this.onPointerleaveLine.bind(this),n.addEventListener("pointerleave",this._onPointerleaveLine)}dispose(){const{line:e}=this;e.removeEventListener("pointerdown",this._onPointerdownLine),e.removeEventListener("pointerenter",this._onPointerenterLine),e.removeEventListener("pointerleave",this._onPointerleaveLine)}set start({x:e,y:t}){this.line.setAttribute("x1",Math.round(e)),this.line.setAttribute("y1",Math.round(t))}set end({x:e,y:t}){this.line.setAttribute("x2",Math.round(e)),this.line.setAttribute("y2",Math.round(t))}set dimension([e,t]){const{lineWidth:i}=k,{element:{style:s},svg:o}=this,n=Math.max(e,i),r=Math.max(t,i);s.width=`${n}px`,s.height=`${r}px`,o.setAttribute("width",n),o.setAttribute("height",r)}set position({x:e,y:t}){const{element:{style:i}}=this;i.top=`${t}px`,i.left=`${e}px`}onPointerdownLine(e){e.stopPropagation(),e.shiftKey||this.view.clearSelection(),this.view.selectEdge(this)}onPointerenterLine(){this.isSemiEdge||this.view.isDraggingEdge||this.isSelected||(this.highlight=!0,this.source.highlight=!0,this.target.highlight=!0)}onPointerleaveLine(){this.isSemiEdge||this.isSelected||(this.highlight=!1,this.source.node.isSelected||(this.source.highlight=!1),this.target.node.isSelected||(this.target.highlight=!1))}updateGeometry(){const{source:{center:{x:e,y:t}},target:{center:{x:i,y:s}},view:{origin:{x:o,y:n}}}=this,r=i<e,h=s<t;this.position={x:Math.round((r?i:e)-o),y:Math.round((h?s:t)-n)};const u=Math.abs(Math.round(i-e)),g=Math.abs(Math.round(s-t));this.dimension=[u,g],this.start={x:r?u:0,y:h?g:0},this.end={x:r?0:u,y:h?0:g}}toObject(){const{isSemiEdge:e,source:t,target:i}=this;if(e)return;const s=t.node.id,o=t.id,n=i.node.id,r=i.id;return L(l({},super.toObject()),{from:[s,o],to:[n,r]})}};let m=k;a(m,"cssClassName","fv-edge"),a(m,"lineWidth",2),a(m,"zIndex",0),a(m,"style",{[`.${k.cssClassName}`]:{display:"inline-block",position:"absolute",border:0,"pointer-events":"none"},[`.${k.cssClassName} line`]:l({"pointer-events":"all",stroke:c.connectionColor,"stroke-width":k.lineWidth},z("stroke")),[`.${f(k.cssClassName)} line`]:{stroke:c.connectionColorHighlighted}});export{m as FlowViewEdge};const b=class extends C{init({label:e,inputs:t=[],outputs:i=[],x:s,y:o}){const{element:n}=this;this.borderWidth=b.borderWidth,this._inputs=new Map,this.inputListDiv=this.createDiv("pins");for(const r of t)this.newInput(r);this.labelDiv=this.createDiv("label"),this.label=e,this._outputs=new Map,this.outputListDiv=this.createDiv("pins");for(const r of i)this.newOutput(r);this.position={x:s,y:o},this._onDblclick=this.onDblclick.bind(this),n.addEventListener("dblclick",this._onDblclick),this._onPointerdown=this.onPointerdown.bind(this),n.addEventListener("pointerdown",this._onPointerdown)}dispose(){const{element:e}=this;e.removeEventListener("dblclick",this._onDblclick),e.removeEventListener("pointerdown",this._onPointerdown)}get label(){return this.labelDiv.textContent}set label(e){this.labelDiv.textContent=e}get inputs(){return Array.from(this._inputs.values())}get outputs(){return Array.from(this._outputs.values())}get position(){return{x:this.x,y:this.y}}set position({x:e=0,y:t=0}={}){const{element:i,view:s}=this;this.x=e,this.y=t,i.style.top=`${t-s.origin.y}px`,i.style.left=`${e-s.origin.x}px`}deleteInput(e){this._inputs.get(e).remove(),this._inputs.delete(e)}deleteOutput(e){this._outputs.get(e).remove(),this._outputs.delete(e)}input(e){return this._inputs.get(e)}output(e){return this._outputs.get(e)}newInput({id:e,name:t,types:i}){const s=new O({id:e,name:t,node:this,types:i,view:this.view,cssClassName:p.cssClassName});this._inputs.set(s.id,s),this.inputListDiv.appendChild(s.element)}newOutput({id:e,name:t,types:i}){const s=new A({id:e,name:t,node:this,types:i,view:this.view,cssClassName:p.cssClassName});this._outputs.set(s.id,s),this.outputListDiv.appendChild(s.element)}onDblclick(e){e.stopPropagation()}onPointerdown(e){if(e.isBubblingFromPin)return;e.isBubblingFromNode=!0,e.shiftKey||this.view.hasSelectedNodes&&this.isSelected||this.view.clearSelection(),this.view.selectNode(this)}toObject(){const{label:e,inputs:t,outputs:i}=this;return L(l({},super.toObject()),{label:e,inputs:t.map(s=>s.toObject()),outputs:i.map(s=>s.toObject())})}};let w=b;a(w,"cssClassName","fv-node"),a(w,"borderWidth",1),a(w,"minSize",p.size*4),a(w,"zIndex",m.zIndex+1),a(w,"style",{[`.${b.cssClassName}`]:l({position:"absolute","background-color":c.nodeBackgroundColor,"border-radius":c.borderRadius,"box-shadow":c.boxShadow,display:"flex","flex-direction":"column","justify-content":"space-between",border:`${b.borderWidth}px solid transparent`,"min-height":`${b.minSize}px`,"min-width":`${b.minSize}px`,width:"fit-content","z-index":b.zIndex},z("border-color")),[`.${f(b.cssClassName)}`]:{"border-color":c.nodeBorderColorHighlighted},[`.${b.cssClassName} .label`]:{"user-select":"none","padding-left":"0.5em","padding-right":"0.5em"},[`.${b.cssClassName} .pins`]:{display:"flex","flex-direction":"row","justify-content":"space-between",height:`${p.size}px`}});export{w as FlowViewNode};const N=class extends C{init({position:e,nodeDefinitions:t}){const{element:i}=this;i.setAttribute("tabindex",0);const s=this.hint=document.createElement("input");s.classList.add(`${N.cssClassName}__hint`),i.appendChild(s);const o=this.input=document.createElement("input");i.appendChild(o),this.position=e,this.nodeDefinitions=t.sort(({label:n},{label:r})=>n<r?-1:1),this._onDblclick=this.onDblclick.bind(this),i.addEventListener("dblclick",this._onDblclick),this._onPointerdown=this.onPointerdown.bind(this),i.addEventListener("pointerdown",this._onPointerdown),this._onKeydown=this.onKeydown.bind(this),o.addEventListener("keydown",this._onKeydown),this._onKeyup=this.onKeyup.bind(this),o.addEventListener("keyup",this._onKeyup)}dispose(){const{element:e,input:t}=this;e.removeEventListener("dblclick",this._onDblclick),e.removeEventListener("pointerdown",this._onPointerdown),t.removeEventListener("keydown",this._onKeydown),t.removeEventListener("keyup",this._onKeyup)}focus(){this.input.focus()}get completion(){return this.hint.getAttribute("placeholder")}set completion(e){this.hint.setAttribute("placeholder",e)}get matchingNodeDefinitions(){const{input:{value:e}}=this;return e.length<2?[]:this.nodeDefinitions.filter(({label:t})=>t.startsWith(e)&&t!==e)}set position({x:e,y:t}){const{element:i,view:s}=this;i.style.top=`${t-s.origin.y}px`,i.style.left=`${e-s.origin.x}px`,this.x=e,this.y=t}get position(){return{x:this.x,y:this.y}}createNode(){const{input:{value:e},nodeDefinitions:t,position:{x:i,y:s},view:o}=this,n=t.find(({label:r})=>r===e)||{};o.newNode(l({x:i,y:s,label:e},n)),o.removeSelector()}onDblclick(e){e.stopPropagation()}onKeydown(e){switch(e.stopPropagation(),!0){case e.code==="Enter":{this.createNode();break}case e.code==="Escape":{this.view.removeSelector();break}case e.code==="Tab":{e.preventDefault();const{completion:t}=this;t&&(this.input.value=t);break}default:}}onKeyup(e){e.stopPropagation();const{input:{value:t},matchingNodeDefinitions:i}=this;switch(i.length){case 0:{this.completion="";break}case 1:{this.completion=i[0].label;break}default:{let s=t;const o=i.reduce((n,r)=>n.label.length<r.label.length?n:r);for(let n=t.length;n<o.label.length;n++){const r=o.label[n];i.every(({label:h})=>h.startsWith(s+r))&&(s+=r)}this.completion=s}}}onPointerdown(e){e.stopPropagation()}};let E=N;a(E,"cssClassName","fv-selector"),a(E,"zIndex",w.zIndex+1),a(E,"style",{[`.${N.cssClassName}`]:{position:"absolute","box-shadow":c.boxShadow,"z-index":N.zIndex},[`.${N.cssClassName} input`]:{border:0,margin:0,outline:0,"border-radius":c.borderRadius,"font-family":c.fontFamily,"font-size":c.fontSize,padding:"0.5em"},[`.${N.cssClassName}__hint`]:{position:"absolute",left:"0",background:"transparent","pointer-events":"none"},[`.${N.cssClassName}__hint::placeholder`]:{opacity:"0.4"}});const x=class extends HTMLElement{static generateStylesheet(e){return Object.entries(e).reduce((t,[i,s])=>[t,`${i} {`,Object.entries(s).map(([o,n])=>`  ${o}: ${n};`).join(`
`),"}"].join(`
`),"")}static pointerCoordinates(e){const{clientX:t,clientY:i,target:s}=e,{left:o,top:n}=s.getBoundingClientRect(),r=Math.round(t-o),h=Math.round(i-n);return{x:r,y:h}}constructor(){super();const e=document.createElement("template");e.innerHTML=["<style>",x.generateStylesheet(x.style),"@media (prefers-color-scheme: dark) {",x.generateStylesheet({":host":M("dark")}),"}","</style>"].join(`
`),this.attachShadow({mode:"open"}).appendChild(e.content.cloneNode(!0)),this._origin={x:0,y:0},this._nodes=new Map,this._edges=new Map;const t=this.itemClass=new Map;Object.entries(x.defaultItems).forEach(([i,s])=>{t.set(i,s)})}get host(){return this._host||{viewChange:()=>{}}}set host(e){this._host=e}connectedCallback(){this.canResize?(this.rootResizeObserver=new ResizeObserver(this.onRootResize.bind(this)),this.rootResizeObserver.observe(this.parentNode)):this.height=this.getAttribute("height")||x.minHeight,this.getAttribute("tabindex")||this.setAttribute("tabindex",0),this.addEventListener("dblclick",this.onDblclick),this.addEventListener("keydown",this.onKeydown),this.addEventListener("pointerdown",this.onPointerdown),this.addEventListener("pointermove",this.onPointermove),this.addEventListener("pointerleave",this.onPointerleave),this.addEventListener("pointerup",this.onPointerup)}disconnectedCallback(){this.canResize&&this.rootResizeObserver.unobserve(this.parentNode),this.removeEventListener("dblclick",this.onDblclick),this.removeEventListener("keydown",this.onKeydown),this.removeEventListener("pointerdown",this.onPointerdown),this.removeEventListener("pointermove",this.onPointermove),this.removeEventListener("pointerleave",this.onPointerleave),this.removeEventListener("pointerup",this.onPointerup)}get canResize(){return"ResizeObserver"in window}get origin(){return this.translateVector&&!this.hasSelectedNodes?{x:this._origin.x+this.translateVector.x,y:this._origin.y+this.translateVector.y}:this._origin}get selectedEdges(){return this.edges.filter(e=>e.isSelected)}get hasSelectedNodes(){return this.selectedNodes.length>0}get isDraggingEdge(){return this.semiEdge instanceof m}get selectedNodeIds(){return this.selectedNodes.map(e=>e.id)}get selectedNodes(){return this.nodes.filter(e=>e.isSelected)}get edges(){return Array.from(this._edges.values())}get nodes(){return Array.from(this._nodes.values())}get nodeDefinitions(){return this.host.nodes}set width(e){this.style.width=`${e}px`}set height(e){this.style.height=`${e}px`}newEdge({id:e,source:t,target:i}){const s=this.itemClass.get("edge"),o=new s({id:e,view:this,cssClassName:s.cssClassName,source:t,target:i});return this.addEdge(o),this.host.viewChange({newEdges:[o.toObject()]}),o}newNode({x:e=0,y:t=0,label:i="node",id:s,nodeType:o="node",inputs:n=[],outputs:r=[]}){const h=this.itemClass.get(o),u=new h({id:s,view:this,cssClassName:h.cssClassName,label:i,inputs:n,outputs:r,x:e,y:t});return this.addNode(u),this.host.viewChange({newNodes:[u.toObject()]}),u}selectEdge(e){e.highlight=!0,e.selected=!0,e.source.highlight=!0,e.target.highlight=!0}selectNode(e){e.highlight=!0,e.selected=!0;for(const t of e.inputs)t.highlight=!0;for(const t of e.outputs)t.highlight=!0;for(const t of this.edges)t.source.node.isSelected&&t.target.node.isSelected?this.selectEdge(t):this.deselectEdge(t)}deselectEdge(e){e.highlight=!1,e.selected=!1,e.source.node.isSelected||(e.source.highlight=!1),e.target.node.isSelected||(e.target.highlight=!1)}deselectNode(e){e.highlight=!1,e.selected=!1;for(const t of e.inputs)t.highlight=!1;for(const t of e.outputs)t.highlight=!1}addEdge(e){this._edges.set(e.id,e)}addNode(e){this._nodes.set(e.id,e)}deleteEdge(e){this._edges.delete(e.id),e.source.highlight=!1,e.target.highlight=!1,this.host.viewChange({deletedEdges:[e.toObject()]}),e.remove()}deleteNode(e){const t=[];for(const i of this.edges)(i.source.node.id===e.id||i.target.node.id===e.id)&&(this.deleteEdge(i),t.push(i.toObject()));this._nodes.delete(e.id),this.host.viewChange({deletedEdges:t,deletedNodes:[e.toObject()]}),e.remove()}edge(e){return this._edges.get(e)}node(e){return this._nodes.get(e)}startTranslation(e){if(this.startDraggingPoint=x.pointerCoordinates(e),this.translateVector={x:0,y:0},this.hasSelectedNodes){const t={};for(const i of this.selectedNodes)t[i.id]=i.position;this.selectedNodesStartPosition=t}}stopTranslation(){this.translateVector&&!this.hasSelectedNodes&&!this.semiEdge&&(this._origin={x:this._origin.x+this.translateVector.x,y:this._origin.y+this.translateVector.y}),this.translateVector=void 0,this.startDraggingPoint=void 0,this.selectedNodesStartPosition=void 0}createSelector({position:e}){return this.selector=new E({id:"selector",view:this,cssClassName:E.cssClassName,position:e,nodeDefinitions:this.nodeDefinitions})}onDblclick(e){const{origin:t}=this;this.clearSelection(),this.removeSelector();const i=x.pointerCoordinates(e);this.createSelector({position:{x:i.x+t.x,y:i.y+t.y}}).focus()}onKeydown(e){switch(e.stopPropagation(),!0){case this.selector instanceof E:return;case e.code==="Backspace":{this.deleteSelectedItems();break}case e.code==="Escape":{this.clearSelection();break}case"KeyU":{this.undo();break}case"KeyR":{this.redo();break}default:}}onPointerdown(e){e.stopPropagation(),this.removeSelector(),e.isBubblingFromNode||this.clearSelection(),this.startTranslation(e)}onPointermove(e){const{hasSelectedNodes:t,semiEdge:i,startDraggingPoint:s}=this;if(s){const o=x.pointerCoordinates(e),n=s.x-o.x,r=s.y-o.y;switch(!0){case!!i:{const{origin:h}=this;i.hasTarget||(i.target.center.x=o.x+h.x,i.target.center.y=o.y+h.y),i.updateGeometry();break}case t:{this.translateVector={x:n,y:r};const{edges:h,selectedNodes:u,selectedNodeIds:g,selectedNodesStartPosition:$}=this;for(const P of u){const{x:X,y:W}=$[P.id];P.position={x:X-n,y:W-r}}for(const P of h)(g.includes(P.source.node.id)||g.includes(P.target.node.id))&&P.updateGeometry();break}default:{this.translateVector={x:n,y:r};const{nodes:h,edges:u}=this;for(const g of h){const{x:$,y:P}=g.position;g.position={x:$,y:P}}for(const g of u)g.updateGeometry()}}}}onPointerleave(){this.stopTranslation()}onPointerup(){this.stopTranslation(),this.removeSemiEdge()}onRootResize(e){for(const t of e)if(this.parentNode===t.target){const i=Array.isArray(t.contentBoxSize)?t.contentBoxSize[0]:t.contentBoxSize;i?(this.width=i.inlineSize,this.height=i.blockSize-10):t.contentRect&&(this.width=t.contentRect.width,this.height=t.contentRect.height)}}createSemiEdge({source:e,target:t}){const i=this.itemClass.get("edge");return this.semiEdge=new i({view:this,cssClassName:i.cssClassName,source:e,target:t})}clearSelection(){for(const e of this.selectedNodes)this.deselectNode(e);for(const e of this.selectedEdges)this.deselectEdge(e)}deleteSelectedItems(){for(const e of this.selectedEdges)this.deleteEdge(e);for(const e of this.selectedNodes)this.deleteNode(e)}removeSemiEdge(){const{semiEdge:e}=this;e instanceof m&&e.remove(),this.semiEdge=void 0}removeSelector(){const{selector:e}=this;e instanceof E&&e.remove(),this.selector=void 0}undo(){}redo(){}};let y=x;a(y,"customElementName","flow-view"),a(y,"minHeight",200),a(y,"defaultItems",{edge:m,node:w}),a(y,"style",l(l(l(l({":host([hidden])":{display:"none"},":host":L(l({},M("light")),{position:"relative",display:"block",overflow:"hidden",border:0,margin:0,outline:0,"background-color":c.backgroundColor,"border-radius":c.borderRadius,"box-shadow":c.boxShadow,"font-family":c.fontFamily,"font-size":c.fontSize,color:c.textColor})},m.style),w.style),p.style),E.style));export{y as FlowViewElement};const D=class{static defineCustomElement(){const{customElementName:e}=y;window.customElements.get(e)||window.customElements.define(e,y)}static nodeDefinitionIsValid(e){if(e===null||typeof e!="object")throw new TypeError("invalid flow-view node definition: must be an object");const{label:t,inputs:i,outputs:s}=e;if(typeof t!="string"||t===""||D.reservedTypes.includes(t))throw new TypeError(`invalid flow-view node label: ${t===""?"empty string":t}`);if(Array.isArray(i)&&Array.isArray(s))for(const o of i.concat(s)){if(o===null||typeof o!="object")throw new TypeError("invalid flow-view node pin: must be an object");const{name:n,types:r}=o;if(typeof n!="undefined"&&(typeof n!="string"||n===""))throw new TypeError(`invalid flow-view node pin name: ${n===""?"empty string":n}`);if(typeof r!="undefined")if(Array.isArray(r)&&r.length>0){for(const h of r)if(typeof h!="string"||h==="")throw new TypeError(`invalid flow-view node pin type: ${h===""?"empty string":h}`)}else throw new TypeError("invalid flow-view node pin, types must be a not empty array")}else throw new TypeError("invalid flow-view node, inputs or outputs are missing")}constructor({container:e,element:t,nodes:i=[]}={}){D.defineCustomElement();const s=new Set;for(const o of i)try{D.nodeDefinitionIsValid(o);const{label:n}=o;if(s.has(n))throw new TypeError(`duplicated flow-view node label ${n}`);s.add(n)}catch(n){throw n}if(this.nodes=i,t instanceof y)t.style.isolation="isolate",t.host=this,this.view=t;else{const o=this.view=document.createElement(y.customElementName);o.style.isolation="isolate",o.host=this,e instanceof HTMLElement?e.appendChild(o):document.body.appendChild(o)}this._onViewChange=()=>{}}clearGraph(){this.view.nodes.clear(),this.view.edges.clear()}loadGraph({nodes:e=[],edges:t=[]}){if(!Array.isArray(e)||!Array.isArray(t))throw new TypeError("Invalid graph");for(const i of e)this.newNode(i);for(const i of t)this.newEdge(i)}get onViewChange(){return this._onViewChange}onChange(e){typeof e=="function"&&(this._onViewChange=e)}viewChange(e){this.onViewChange(e)}newEdge({id:e,from:[t,i],to:[s,o]}){const n=this.view.node(t),r=this.view.node(s),h=n.output(i),u=r.input(o);return this.view.newEdge({id:e,source:h,target:u})}newNode({id:e,label:t,nodeType:i,inputs:s,outputs:o,x:n,y:r}={}){return this.view.newNode({id:e,label:t,nodeType:i,inputs:s,outputs:o,x:n,y:r})}};let I=D;a(I,"reservedTypes",["node","edge"]);export{I as FlowView};
